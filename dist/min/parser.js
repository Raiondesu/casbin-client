var E=46;var w=32,l=58,A=34,f=39,C=48,k=57,i=69,n=101,x=92;var o=5,S=10,y=20,b=30,p=40;var h=80,G=90;var _=140;var L=170;var Q=200;var V,B,P=(K)=>(V=0,B=K,K=J(),B[V]?$():K||""),$=(K="Bad syntax",F=B.slice(0,V).split(`
`),M=F.pop())=>{let X=B.slice(V-108,V).split(`
`).pop(),R=B.slice(V,V+108).split(`
`).shift();throw EvalError(`${K} at ${F.length}:${M.length} \`${V>=108?"…":""}${X}┃${R}\``,"font-weight: bold")},T=(K,F=V,M)=>{while(M=K(B.charCodeAt(V)))V+=M;return B.slice(F,V)},q=(K=1,F=V)=>(V+=K,B.slice(F,V)),J=(K=0,F)=>{let M,X,R,W;while((M=c())&&(R=((W=I[M])&&W(X,K))??(!X&&T(P.id))))X=R;if(F)M==F?V++:$();return X},c=(K)=>{while((K=B.charCodeAt(V))<=w)V++;return K},M0=P.id=(K)=>K>=48&&K<=57||K>=65&&K<=90||K>=97&&K<=122||K==36||K==95||K>=192&&K!=215&&K!=247,I=[],Y=(K,F=w,M,X=K.charCodeAt(0),R=K.length,W=I[X],H=K.toUpperCase()!==K)=>I[X]=(N,u,m,e=V)=>(m?K==m:(R<2||B.substr(V,R)==K)&&(m=K))&&u<F&&!(H&&P.id(B.charCodeAt(V+R)))&&(V+=R,M(N)||(V=e,!W&&$()))||W?.(N,u,m),Z=(K,F,M=!1)=>Y(K,F,(X,R)=>X&&(R=J(F-(M?0.5:0)))&&[K,X,R]),v=(K,F,M)=>Y(K,F,(X)=>M?X&&[K,X]:!X&&(X=J(F-0.5))&&[K,X]),j=(K,F,M)=>{Y(K,F,(X,R)=>(R=J(F),X?.[0]!==K&&(X=[K,X||null]),R?.[0]===K?X.push(...R.slice(1)):X.push(R||null),X))},U=(K,F)=>Y(K[0],F,(M)=>!M&&[K,J(0,K.charCodeAt(1))]),O=(K,F)=>Y(K[0],F,(M)=>M&&[K,M,J(0,K.charCodeAt(1))||null]);var s=(K,F)=>[,(K=+T((M)=>M===E||M>=C&&M<=k||(M===i||M===n?2:0)))!=K?$():K];I[E]=(K)=>!K&&s();for(let K=C;K<=k;K++)I[K]=(F)=>F?$():s();var a={n:`
`,r:"\r",t:"\t",b:"\b",f:"\f",v:"\v"},t=(K)=>(F,M,X="")=>{F&&$("Unexpected string"),q();while(M=B.charCodeAt(V),M-K)if(M===x)q(),M=q(),X+=a[M]||M;else X+=q();return q()||$("Bad string"),[,X]};I[A]=t(A);I[f]=t(f);var z=(K)=>!Array.isArray(K)?z.id(K):!K[0]?()=>K[1]:g[K[0]].call(...K),Y0=z.id=(K)=>(F)=>F?.[K],g={},D=(K,F,M=g[K])=>g[K]=(...X)=>F(...X)||M?.(...X),d=(K,F,M,X,R)=>K[0]==="()"&&K.length==2?d(K[1],F,M):typeof K==="string"?(W)=>F(W,K,W):K[0]==="."?(X=z(K[1]),R=K[2],(W)=>F(X(W),R,W)):K[0]==="[]"&&K.length===3?(X=z(K[1]),R=z(K[2]),(W)=>F(X(W),R(W),W)):M?(K=z(K),(W)=>F([K(W)],0,W)):()=>$("Bad left value");O("()",L);D("()",(K,F,M)=>F!==void 0&&(M=!F?()=>[]:F[0]===","?(F=F.slice(1).map((X)=>!X?err():z(X)),(X)=>F.map((R)=>R(X))):(F=z(F),(X)=>[F(X)]),d(K,(X,R,W)=>X[R](...M(W)),!0)));O("[]",L);D("[]",(K,F)=>!F?err():(K=z(K),F=z(F),(M)=>K(M)[F(M)]));Z(".",L);D(".",(K,F)=>(K=z(K),F=!F[0]?F[1]:F,(M)=>K(M)[F]));U("()",L);D("()",(K,F)=>F===void 0&&(!K&&$("Empty ()"),z(K)));var r=(...K)=>(K=K.map(z),(F)=>K.map((M)=>M(F)).pop());j(",",S),D(",",r);j(";",o,!0),D(";",r);Y("?",y,(K,F,M)=>K&&(F=J(y-1))&&T((X)=>X===l)&&(M=J(y-1),["?",K,F,M]));D("?",(K,F,M)=>(K=z(K),F=z(F),M=z(M),(X)=>K(X)?F(X):M(X)));Y("true",Q,(K)=>K?err():[,!0]);Y("false",Q,(K)=>K?err():[,!1]);U("[]",Q);D("[]",(K,F)=>F===void 0&&(K=!K?[]:K[0]===","?K.slice(1):[K],K=K.map((M)=>M[0]==="..."?(M=z(M[1]),(X)=>M(X)):(M=z(M),(X)=>[M(X)])),(M)=>K.flatMap((X)=>X(M))));U("{}",Q);D("{}",(K,F)=>F===void 0&&(K=!K?[]:K[0]!==","?[K]:K.slice(1),K=K.map((M)=>z(typeof M==="string"?[":",M,M]:M)),(M)=>Object.fromEntries(K.flatMap((X)=>X(M)))));Z(":",y-1,!0);D(":",(K,F)=>(F=z(F),Array.isArray(K)?(K=z(K),(M)=>[[K(M),F(M)]]):(M)=>[[K,F(M)]]));Z("=>",y,!0);D("=>",(K,F)=>(K=K[0]==="()"?K[1]:K,K=!K?[]:K[0]===","?K=K.slice(1):K=[K],F=z(F[0]==="{}"?F[1]:F),(M=null)=>(M=Object.create(M),(...X)=>(K.map((R,W)=>M[R]=X[W]),F(M)))));Z("");Y("?.",L,(K)=>K&&["?.",K]);D("?.",(K)=>(K=z(K),(F)=>K(F)||(()=>{})));Y("?.",L,(K,F)=>K&&(F=J(L),!F?.map)&&["?.",K,F]);D("?.",(K,F)=>F&&(K=z(K),(M)=>K(M)?.[F]));D("()",(K,F,M,X,R,W)=>F!==void 0&&K[0]==="?."&&(K[2]||Array.isArray(K[1]))&&(X=!F?()=>[]:F[0]===","?(F=F.slice(1).map(z),(H)=>F.map((N)=>N(H))):(F=z(F),(H)=>[F(H)]),!K[2]&&(W=!0,K=K[1]),K[0]==="[]"&&K.length===3?R=z(K[2]):R=()=>K[2],M=z(K[1]),W?(H)=>M(H)?.[R(H)]?.(...X(H)):(H)=>M(H)?.[R(H)](...X(H))));v("...",_);D("...",(K)=>(K=z(K),(F)=>Object.entries(K(F))));v("!",_),D("!",(K,F)=>!F&&(K=z(K),(M)=>!K(M)));Z("||",b);D("||",(K,F)=>(K=z(K),F=z(F),(M)=>K(M)||F(M)));Z("&&",p);D("&&",(K,F)=>(K=z(K),F=z(F),(M)=>K(M)&&F(M)));Z("==",h),D("==",(K,F)=>F&&(K=z(K),F=z(F),(M)=>K(M)==F(M)));Z("!=",h),D("!=",(K,F)=>F&&(K=z(K),F=z(F),(M)=>K(M)!=F(M)));Z(">",G),D(">",(K,F)=>F&&(K=z(K),F=z(F),(M)=>K(M)>F(M)));Z("<",G),D("<",(K,F)=>F&&(K=z(K),F=z(F),(M)=>K(M)<F(M)));Z(">=",G),D(">=",(K,F)=>F&&(K=z(K),F=z(F),(M)=>K(M)>=F(M)));Z("<=",G),D("<=",(K,F)=>F&&(K=z(K),F=z(F),(M)=>K(M)<=F(M)));Z("in",90);D("in",(K,F)=>F&&(K=z(K),F=z(F),(M)=>{let X=F(M),R=K(M);return Array.isArray(X)?X.includes(R):(R in(X??{}))}));Y("undefined",20,(K)=>K?$():[,void 0]);Y("NaN",20,(K)=>K?$():[,NaN]);Y("null",20,(K)=>K?$():[,null]);function Z9(K){return z(P(K))}export{Z9 as parseExpression};
