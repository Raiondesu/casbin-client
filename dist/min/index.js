function p(o,c={}){let{store:P=globalThis.sessionStorage??{},key:a="auth",fallback:m=()=>!1}=c,r={permissions:null,local:P.getItem?.(a),wait:void 0},t=o(),A=(e)=>(r.permissions=e,{get permissions(){return r.permissions},updatePermissions:()=>r.wait=u(o),can:new Proxy(i,{get(s,n){if(n in s)return s[n];return i.bind(null,n)}})});if(t instanceof Promise){let e=t.then((s)=>u(()=>s));return(r.wait=Promise.race([e,Promise.resolve(r.local).then(y).catch(()=>null).then(()=>r.wait=e)])).then(A)}return r.wait=Promise.resolve(t),A(t);function y(e){return r.permissions=JSON.parse(e??"null")}async function u(e){let s=r.permissions=await e();try{await P.setItem?.(a,JSON.stringify(s))}catch{}return s}function i(e,s){return Array.isArray(e)?e.every((n)=>i(n,s)):Array.isArray(s)?s.every((n)=>i(e,n)):r.permissions?.[e]?.includes(s)??m(e,s)}}export{p as createAuthorizer};
