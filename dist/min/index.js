function U(F,O={}){let{store:I=globalThis.sessionStorage??{},key:J="auth",fallback:Q=()=>!1}=O,R=I.getItem?.(J),K=(q,B)=>{let x={permissions:null},C=()=>{return M(x.permissions=q()??x.permissions),x.permissions};return{get permissions(){return C()},remote:B,can:new Proxy(E.bind(null,C),{get(N,H){if(H in N)return N[H];return E.bind(null,C,H)}})}};if(!(F instanceof Promise))return K(F);let T=F,D={permissions:null},G=T.then(async(q)=>{return await M(D.permissions=q),D.permissions}),L=Promise.resolve(R).then((q)=>JSON.parse(q??"null"));return Promise.race([G.catch(()=>L).then((q)=>D.permissions=q),L.catch(()=>G)]).then((q)=>D.permissions=q),K(()=>D.permissions,G);async function M(q){try{await I.setItem?.(J,JSON.stringify(q))}catch{}}function E(q,B,x){return Array.isArray(B)?B.every((C)=>E(q,C,x)):Array.isArray(x)?x.every((C)=>E(q,B,C)):q()?.[B]?.includes(x)??Q(B,x)}}export{U as createAuthorizer};
