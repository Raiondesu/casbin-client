function l(t,A={}){let{store:i=globalThis.sessionStorage??{},key:P="auth",fallback:u=()=>!1}=A,c={permissions:null,local:i.getItem?.(P)},a=(n)=>({get permissions(){return n},can:new Proxy(s.bind(null,n),{get(e,r){if(r in e)return e[r];return s.bind(null,n,r)}})});if(t instanceof Promise){let n=t.then(y);return Promise.race([n,Promise.resolve(c.local).then((e)=>JSON.parse(e??"null")).catch(()=>null).then(()=>n)]).then(a)}return Promise.resolve(t),a(t);async function y(n){let e=await n;try{await i.setItem?.(P,JSON.stringify(e))}catch{}return e}function s(n,e,r){return Array.isArray(e)?e.every((o)=>s(n,o,r)):Array.isArray(r)?r.every((o)=>s(n,e,o)):n?.[e]?.includes(r)??u(e,r)}}export{l as createAuthorizer};
