function l(P,c={}){let{store:a=globalThis.sessionStorage??{},key:A="auth",fallback:m=()=>!1}=c,e={permissions:null,local:a.getItem?.(A),wait:void 0},t=P(),o=(s)=>(e.permissions=s,{get permissions(){return e.permissions},updatePermissions:()=>e.wait=y(P),can:new Proxy(i,{get(n,r){if(r in n)return n[r];return i.bind(null,r)}})});if(e.local instanceof Promise)return(e.wait=Promise.race([t,e.local.then(u).catch(()=>null)])).then(o);if(t instanceof Promise)return e.permissions=u(e.local),e.wait=t,e.wait.then(o);return e.wait=Promise.resolve(t),o(t);function u(s){return e.permissions=JSON.parse(s??"null")}async function y(s){let n=e.permissions=await s();try{await a.setItem?.(A,JSON.stringify(n))}catch{}return n}function i(s,n){return Array.isArray(s)?s.every((r)=>i(r,n)):Array.isArray(n)?n.every((r)=>i(s,r)):e.permissions?.[s]?.includes(n)??m(s,n)}}export{l as createAuthorizer};
