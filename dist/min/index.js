import{a as O}from"./core.js";function V(B,Q={}){let{store:G=globalThis.sessionStorage??{},key:H="auth",fallback:R=()=>!1}=Q,I=(j,D)=>{let E={permissions:null},M=()=>{let x=L();return K(E.permissions=j()??E.permissions??(x instanceof Promise?null:x)),E.permissions},N=O(M,{fallback:R});return{get permissions(){return M()},remote:D,can:new Proxy(N,{get(x,F){if(F in x)return x[F];return N.bind(null,F)}})}};if(!(B instanceof Promise))return I(B);let T=B,q={permissions:null},C=T.then(async(j)=>{return await K(q.permissions=j),q.permissions}),J=Promise.resolve(L());return Promise.race([C.catch(()=>J).then((j)=>q.permissions=j),J.catch(()=>C)]).then((j)=>q.permissions=j),I(()=>q.permissions,C);async function K(j){try{await G.setItem?.(H,JSON.stringify(j))}catch{}}function L(){let j=G.getItem?.(H);if(!(j instanceof Promise))return JSON.parse(j??"null");return j.then((D)=>JSON.parse(D??"null"))}}export{V as createAuthorizer};
