import{a as M}from"./model.js";var g=["act","obj"];function b(e,n){let{request:o,parseExpression:r,permissionModel:t=g}=n??{},i=M(e.m,{parseExpression:r});return K(i,e,{request:o,permissionModel:t})}function K(e,n,o){let{request:r,permissionModel:t=g}=o??{},[i,...l]=r??["r"],s=x(i),u=v(e.roleDefinition,n.g),p=e.matchers[`m${s===1?"":s}`];return n.p.reduce((c,[f,...D])=>{let R=x(f);if(s!==R)return c;let a=e.policyDefinition[f],d=m(a,D),[y,C]=t.map((h)=>d[h]),q=c[y]??[],P=()=>({...c,[y]:[...q,C]});if(!r)return P();let O=m(a,l,d),S={[i]:O,[f]:d,...u,...e.matchers,...e.policyEffect};return p(S)?P():c},{})}function x(e){return Number(e.slice(1)||"1")}function m(e,n,o){return e.reduce((r,t,i)=>({...r,[t]:n[i]??o?.[t]}),{})}function v(e,n){let o={};return n?.reduce((r,[t,...i])=>{return o[t]??=[],o[t].push(i),{...r,[t]:(...l)=>{return o[t].some((s)=>l.every((u,p)=>s[p]===u))}}},{})}export{m as toModelContext,b as fromPolicySource,K as fromCustomModel,g as defaultPermissionModel,v as createRoleContext};
