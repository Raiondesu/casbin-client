import{a as f}from"./model.js";function D(e,i){let{request:u,parseExpression:o}=i??{},a=f(e.m,{parseExpression:o});return O(a,e,{request:u})}function O(e,i,u){let{request:o}=u??{},a=Object.values(e.matchers),y=i.p.map(([,...r])=>Object.fromEntries(r.map((t,s)=>[e.policyDefinition[s],t]))),g=i.g?.reduce((r,[t,...s])=>({...r,[t]:(...P)=>P.every((c,p)=>c===s[p])}),{});return y.reduce((r,t)=>{let s=t[e.policyDefinition[2]],P=r[s]??[],c=t[e.policyDefinition[1]],p=e.policyDefinition.slice(3).map((n)=>t[n]),l=()=>({...r,[s]:[...P,c,...p]});if(!o)return l();let d=[o[0],c,s,...p].reduce((n,M,m)=>({...n,[e.requestDefinition[m]]:o[m]??M}),{}),x={...g,p:t,r:d};return a.every((n)=>n(x))?l():r},{})}export{D as fromPolicySource,O as fromCustomModel};
